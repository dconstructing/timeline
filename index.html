<!DOCTYPE HTML>
<html>
	<head>
		<title>Timeline basic demo</title>
		<script src="https://unpkg.com/timeline-plus/dist/timeline.js"></script>
		<link href="https://unpkg.com/timeline-plus/dist/timeline.css" rel="stylesheet" type="text/css" />

		<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
		<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
		<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
	</head>
	<body>
		<div id="react"></div>

		<script type="text/babel">
			function generateChartItems(events) {
				return events.map((event, i) => {
					return {
						start: event.datetime,
						content: event.note
					}
				});
			}

			class Chart extends React.Component {
				constructor(props) {
					super(props);
				}

				componentDidMount() {
					var container = document.getElementById('mytimeline');
					const items = generateChartItems(this.props.events);
					this.timeline = new timeline.Timeline(container, items, {});
				}

				shouldComponentUpdate(nextProps, nextState) {
					console.log('checking update')
					const items = generateChartItems(nextProps.events);
					this.timeline.setItems(items)
					this.timeline.redraw();
					return false;
				}

				render() {
					return <div id="mytimeline" />
				}
			}

			class TimelineEvent extends React.Component {
				constructor(props) {
					super(props);

					this.datetimeChanged = this.datetimeChanged.bind(this);
					this.noteChanged = this.noteChanged.bind(this); 
				}

				datetimeChanged(event) {
					const updatedEvent = {
						datetime: event.target.value,
						note: this.props.event.note
					}
					this.props.onUpdate(this.props.sort, updatedEvent)
				}

				noteChanged(event) {
					const updatedEvent = {
						datetime: this.props.event.datetime,
						note: event.target.value
					}
					this.props.onUpdate(this.props.sort, updatedEvent)
				}

				render() {
					return (
						<div>
							<form>
								<input placeholder="Datetime" value={this.props.event.datetime} onChange={this.datetimeChanged} />
								<input placeholder="Note" value={this.props.event.note} onChange={this.noteChanged} />
							</form>
						</div>
					)
				}
			}

			function blankTimelineEvent() {
				return {
					datetime: '',
					note: ''
				}
			}

			class TimelineEvents extends React.Component {
				constructor(props) {
					super(props);
					this.state = {
						events: [],
						newEvent: blankTimelineEvent()
					};

					this.datetimeChanged = this.datetimeChanged.bind(this);
					this.noteChanged = this.noteChanged.bind(this); 
					this.handleSubmit = this.handleSubmit.bind(this);
					this.handleUpdate = this.handleUpdate.bind(this);
				}

				datetimeChanged(event) {
					const newEvent = this.state.newEvent;
					newEvent.datetime = event.target.value;
					this.setState({newEvent: newEvent});
				}

				noteChanged(event) {
					const newEvent = this.state.newEvent;
					newEvent.note = event.target.value;
					this.setState({newEvent: newEvent});
				}

				handleSubmit(event) {
					console.log(this.state)
					const eventSet = this.state.events;
					eventSet.push(this.state.newEvent);
					this.setState({events: eventSet, newEvent: blankTimelineEvent()});
					event.preventDefault();
				}

				handleUpdate(sort, timelineEvent) {
					console.log(this.state);
					console.log(sort, timelineEvent);
					const eventSet = this.state.events;
					eventSet.splice(sort, 1, timelineEvent);
					console.log(eventSet);
					this.setState({events: eventSet});
				}

				render() {
					const events = this.state.events.map((event, i) => <TimelineEvent key={i} sort={i} event={event} onUpdate={this.handleUpdate} />)
					return (
						<div>
							<Chart events={this.state.events} />
							{events}
							<div>
								<form onSubmit={this.handleSubmit}>
									<input placeholder="Datetime" value={this.state.newEvent.datetime} onChange={this.datetimeChanged} />
									<input placeholder="Note" value={this.state.newEvent.note} onChange={this.noteChanged} />
									<button type="submit">Add</button>
								</form>
							</div>
						</div>
					)
				}
			}
			
			ReactDOM.render(
				<TimelineEvents />,
				document.getElementById('react')
			);
		</script>
	</body>
</html>